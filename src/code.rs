use {
    crate::{
        aliasable_box::AliasableBox,
        decode::{Decode, DecodeError, Decoder},
        exec::{self, Imm, Reg, Stk, ThreadedInstr},
        ops::*,
        ref_::RefType,
        val::ValType,
    },
    std::sync::Arc,
};

#[derive(Debug)]
pub(crate) enum Code {
    Uncompiled(UncompiledCode),
    Compiling,
    Compiled(CompiledCode),
}

#[derive(Clone, Debug)]
pub(crate) struct UncompiledCode {
    pub(crate) locals: Box<[ValType]>,
    pub(crate) expr: Arc<[u8]>,
}

impl Decode for UncompiledCode {
    fn decode(decoder: &mut Decoder<'_>) -> Result<Self, DecodeError> {
        use std::iter;

        let mut code_decoder = decoder.decode_decoder()?;
        Ok(Self {
            locals: {
                let mut locals = Vec::new();
                for _ in 0u32..code_decoder.decode()? {
                    let count = code_decoder.decode()?;
                    if count > usize::try_from(u32::MAX).unwrap() - locals.len() {
                        return Err(DecodeError::new("too many locals"));
                    }
                    locals.extend(iter::repeat(code_decoder.decode::<ValType>()?).take(count));
                }
                locals.into()
            },
            expr: code_decoder.read_bytes_until_end().into(),
        })
    }
}

#[derive(Debug)]
pub(crate) struct CompiledCode {
    pub(crate) max_stack_height: usize,
    pub(crate) local_count: usize,
    pub(crate) code: AliasableBox<[InstrSlot]>,
}

pub(crate) type InstrSlot = usize;

pub(crate) trait InstrVisitor {
    type Error;

    // Control instructions
    fn visit_nop(&mut self) -> Result<(), Self::Error>;
    fn visit_unreachable(&mut self) -> Result<(), Self::Error>;
    fn visit_block(&mut self, type_: BlockType) -> Result<(), Self::Error>;
    fn visit_loop(&mut self, type_: BlockType) -> Result<(), Self::Error>;
    fn visit_if(&mut self, type_: BlockType) -> Result<(), Self::Error>;
    fn visit_else(&mut self) -> Result<(), Self::Error>;
    fn visit_end(&mut self) -> Result<(), Self::Error>;
    fn visit_br(&mut self, label_idx: u32) -> Result<(), Self::Error>;
    fn visit_br_if(&mut self, label_idx: u32) -> Result<(), Self::Error>;
    fn visit_br_table(
        &mut self,
        label_idxs: &[u32],
        default_label_idx: u32,
    ) -> Result<(), Self::Error>;
    fn visit_return(&mut self) -> Result<(), Self::Error>;
    fn visit_call(&mut self, func_idx: u32) -> Result<(), Self::Error>;
    fn visit_call_indirect(&mut self, table_idx: u32, type_idx: u32) -> Result<(), Self::Error>;

    // Reference instructions
    fn visit_ref_null(&mut self, type_: RefType) -> Result<(), Self::Error>;
    fn visit_ref_is_null(&mut self) -> Result<(), Self::Error>;
    fn visit_ref_func(&mut self, func_idx: u32) -> Result<(), Self::Error>;

    // Parametric instructions
    fn visit_drop(&mut self) -> Result<(), Self::Error>;
    fn visit_select(&mut self, types_: Option<ValType>) -> Result<(), Self::Error>;

    // Variable instructions
    fn visit_local_get(&mut self, local_idx: u32) -> Result<(), Self::Error>;
    fn visit_local_set(&mut self, local_idx: u32) -> Result<(), Self::Error>;
    fn visit_local_tee(&mut self, local_idx: u32) -> Result<(), Self::Error>;
    fn visit_global_get(&mut self, global_idx: u32) -> Result<(), Self::Error>;
    fn visit_global_set(&mut self, global_idx: u32) -> Result<(), Self::Error>;

    // Table instructions
    fn visit_table_get(&mut self, table_idx: u32) -> Result<(), Self::Error>;
    fn visit_table_set(&mut self, table_idx: u32) -> Result<(), Self::Error>;
    fn visit_table_size(&mut self, table_idx: u32) -> Result<(), Self::Error>;
    fn visit_table_grow(&mut self, table_idx: u32) -> Result<(), Self::Error>;
    fn visit_table_fill(&mut self, table_idx: u32) -> Result<(), Self::Error>;
    fn visit_table_copy(
        &mut self,
        dst_table_idx: u32,
        src_table_idx: u32,
    ) -> Result<(), Self::Error>;
    fn visit_table_init(&mut self, table_idx: u32, elem_idx: u32) -> Result<(), Self::Error>;
    fn visit_elem_drop(&mut self, elem_idx: u32) -> Result<(), Self::Error>;

    // Memory instructions
    fn visit_load(&mut self, arg: MemArg, info: LoadInfo) -> Result<(), Self::Error>;
    fn visit_store(&mut self, arg: MemArg, info: StoreInfo) -> Result<(), Self::Error>;
    fn visit_memory_size(&mut self) -> Result<(), Self::Error>;
    fn visit_memory_grow(&mut self) -> Result<(), Self::Error>;
    fn visit_memory_fill(&mut self) -> Result<(), Self::Error>;
    fn visit_memory_copy(&mut self) -> Result<(), Self::Error>;
    fn visit_memory_init(&mut self, data_idx: u32) -> Result<(), Self::Error>;
    fn visit_data_drop(&mut self, data_idx: u32) -> Result<(), Self::Error>;

    // Numeric instructions
    fn visit_i32_const(&mut self, val: i32) -> Result<(), Self::Error>;
    fn visit_i64_const(&mut self, val: i64) -> Result<(), Self::Error>;
    fn visit_f32_const(&mut self, val: f32) -> Result<(), Self::Error>;
    fn visit_f64_const(&mut self, val: f64) -> Result<(), Self::Error>;
    fn visit_un_op(&mut self, info: UnOpInfo) -> Result<(), Self::Error>;
    fn visit_bin_op(&mut self, info: BinOpInfo) -> Result<(), Self::Error>;
}

#[derive(Clone, Copy, Debug)]
pub(crate) enum BlockType {
    TypeIdx(u32),
    ValType(Option<ValType>),
}

impl Decode for BlockType {
    fn decode(decoder: &mut Decoder<'_>) -> Result<Self, DecodeError> {
        fn decode_i33_tail(decoder: &mut Decoder<'_>, mut value: i64) -> Result<i64, DecodeError> {
            let mut shift = 0;
            loop {
                let byte = decoder.read_byte()?;
                if shift >= 26 && byte >> 33 - shift != 0 {
                    let sign = (byte << 1) as i8 >> (33 - shift);
                    if byte & 0x80 != 0x00 || sign != 0 && sign != -1 {
                        return Err(DecodeError::new("malformed s33"));
                    }
                }
                value |= ((byte & 0x7F) as i64) << shift;
                if byte & 0x80 == 0 {
                    break;
                }
                shift += 7;
            }
            let shift = 58 - shift.min(26);
            Ok(value << shift >> shift)
        }

        match decoder.read_byte()? {
            0x40 => Ok(BlockType::ValType(None)),
            0x7F => Ok(BlockType::ValType(Some(ValType::I32))),
            0x7E => Ok(BlockType::ValType(Some(ValType::I64))),
            0x7D => Ok(BlockType::ValType(Some(ValType::F32))),
            0x7C => Ok(BlockType::ValType(Some(ValType::F64))),
            0x70 => Ok(BlockType::ValType(Some(ValType::FuncRef))),
            0x6F => Ok(BlockType::ValType(Some(ValType::ExternRef))),
            byte => {
                let value = (byte & 0x7F) as i64;
                let value = if byte & 0x80 == 0x00 {
                    value
                } else {
                    decode_i33_tail(decoder, value)?
                };
                if value < 0 {
                    return Err(DecodeError::new(""));
                }
                Ok(BlockType::TypeIdx(value as u32))
            }
        }
    }
}

#[derive(Clone, Copy, Debug)]
pub(crate) struct MemArg {
    pub(crate) align: u32,
    pub(crate) offset: u32,
}

impl Decode for MemArg {
    fn decode(decoder: &mut Decoder<'_>) -> Result<Self, DecodeError> {
        Ok(Self {
            align: decoder.decode()?,
            offset: decoder.decode()?,
        })
    }
}

#[derive(Clone, Copy, Debug)]
pub(crate) struct LoadInfo {
    pub(crate) max_align: u32,
    pub(crate) op: UnOpInfo,
}

#[derive(Clone, Copy, Debug)]
pub(crate) struct StoreInfo {
    pub(crate) max_align: u32,
    pub(crate) op: BinOpInfo,
}

#[derive(Clone, Copy, Debug)]
pub(crate) struct UnOpInfo {
    pub(crate) _name: &'static str,
    pub(crate) input_type: ValType,
    pub(crate) output_type: Option<ValType>,
    pub(crate) instr_s: ThreadedInstr,
    pub(crate) instr_r: ThreadedInstr,
    pub(crate) instr_i: Option<ThreadedInstr>,
}

#[derive(Clone, Copy, Debug)]
pub(crate) struct BinOpInfo {
    pub(crate) _name: &'static str,
    pub(crate) input_type_0: ValType,
    pub(crate) input_type_1: ValType,
    pub(crate) output_type: Option<ValType>,
    pub(crate) instr_ss: ThreadedInstr,
    pub(crate) instr_rs: ThreadedInstr,
    pub(crate) instr_is: ThreadedInstr,
    pub(crate) instr_ir: ThreadedInstr,
    pub(crate) instr_ii: Option<ThreadedInstr>,
    pub(crate) instr_sr: ThreadedInstr,
    pub(crate) instr_si: ThreadedInstr,
    pub(crate) instr_ri: ThreadedInstr,
    pub(crate) instr_rr: Option<ThreadedInstr>,
}

pub(crate) fn decode_instr<V>(
    decoder: &mut Decoder<'_>,
    label_idxs: &mut Vec<u32>,
    visitor: &mut V,
) -> Result<(), V::Error>
where
    V: InstrVisitor,
    V::Error: From<DecodeError>,
{
    match decoder.read_byte()? {
        0x00 => visitor.visit_unreachable(),
        0x01 => visitor.visit_nop(),
        0x02 => visitor.visit_block(decoder.decode()?),
        0x03 => visitor.visit_loop(decoder.decode()?),
        0x04 => visitor.visit_if(decoder.decode()?),
        0x05 => visitor.visit_else(),
        0x0B => visitor.visit_end(),
        0x0C => visitor.visit_br(decoder.decode()?),
        0x0D => visitor.visit_br_if(decoder.decode()?),
        0x0E => {
            label_idxs.clear();
            for label_idx in decoder.decode_iter()? {
                label_idxs.push(label_idx?);
            }
            visitor.visit_br_table(&label_idxs, decoder.decode()?)?;
            Ok(())
        }
        0x0F => visitor.visit_return(),
        0x10 => visitor.visit_call(decoder.decode()?),
        0x11 => {
            let type_idx = decoder.decode()?;
            let table_idx = decoder.decode()?;
            visitor.visit_call_indirect(table_idx, type_idx)
        }
        0x1A => visitor.visit_drop(),
        0x1B => visitor.visit_select(None),
        0x1C => {
            if decoder.decode::<u32>()? != 1 {
                return Err(DecodeError::new(""))?;
            }
            visitor.visit_select(Some(decoder.decode()?))?;
            Ok(())
        }
        0x20 => visitor.visit_local_get(decoder.decode()?),
        0x21 => visitor.visit_local_set(decoder.decode()?),
        0x22 => visitor.visit_local_tee(decoder.decode()?),
        0x23 => visitor.visit_global_get(decoder.decode()?),
        0x24 => visitor.visit_global_set(decoder.decode()?),
        0x25 => visitor.visit_table_get(decoder.decode()?),
        0x26 => visitor.visit_table_set(decoder.decode()?),
        0x28 => visitor.visit_load(
            decoder.decode()?,
            LoadInfo {
                max_align: 2,
                op: UnOpInfo {
                    _name: "i32_load",
                    input_type: ValType::I32,
                    output_type: Some(ValType::I32),
                    instr_s: exec::load::<i32, Stk, Reg>,
                    instr_r: exec::load::<i32, Reg, Reg>,
                    instr_i: Some(exec::load::<i32, Imm, Reg>),
                },
            },
        ),
        0x29 => visitor.visit_load(
            decoder.decode()?,
            LoadInfo {
                max_align: 3,
                op: UnOpInfo {
                    _name: "i64_load",
                    input_type: ValType::I32,
                    output_type: Some(ValType::I64),
                    instr_s: exec::load::<i64, Stk, Reg>,
                    instr_r: exec::load::<i64, Reg, Reg>,
                    instr_i: Some(exec::load::<i64, Imm, Reg>),
                },
            },
        ),
        0x2A => visitor.visit_load(
            decoder.decode()?,
            LoadInfo {
                max_align: 2,
                op: UnOpInfo {
                    _name: "f32_load",
                    input_type: ValType::I32,
                    output_type: Some(ValType::F32),
                    instr_s: exec::load::<f32, Stk, Reg>,
                    instr_r: exec::load::<f32, Reg, Reg>,
                    instr_i: Some(exec::load::<f32, Imm, Reg>),
                },
            },
        ),
        0x2B => visitor.visit_load(
            decoder.decode()?,
            LoadInfo {
                max_align: 3,
                op: UnOpInfo {
                    _name: "f64_load",
                    input_type: ValType::I32,
                    output_type: Some(ValType::F64),
                    instr_s: exec::load::<f64, Stk, Reg>,
                    instr_r: exec::load::<f64, Reg, Reg>,
                    instr_i: Some(exec::load::<f64, Imm, Reg>),
                },
            },
        ),
        0x2C => visitor.visit_load(
            decoder.decode()?,
            LoadInfo {
                max_align: 0,
                op: UnOpInfo {
                    _name: "i32_load8_s",
                    input_type: ValType::I32,
                    output_type: Some(ValType::I32),
                    instr_s: exec::load_n::<i32, i8, Stk, Reg>,
                    instr_r: exec::load_n::<i32, i8, Reg, Reg>,
                    instr_i: Some(exec::load_n::<i32, i8, Imm, Reg>),
                },
            },
        ),
        0x2D => visitor.visit_load(
            decoder.decode()?,
            LoadInfo {
                max_align: 0,
                op: UnOpInfo {
                    _name: "i32_load8_u",
                    input_type: ValType::I32,
                    output_type: Some(ValType::I32),
                    instr_s: exec::load_n::<u32, u8, Stk, Reg>,
                    instr_r: exec::load_n::<u32, u8, Reg, Reg>,
                    instr_i: Some(exec::load_n::<u32, u8, Imm, Reg>),
                },
            },
        ),
        0x2E => visitor.visit_load(
            decoder.decode()?,
            LoadInfo {
                max_align: 1,
                op: UnOpInfo {
                    _name: "i32_load16_s",
                    input_type: ValType::I32,
                    output_type: Some(ValType::I32),
                    instr_s: exec::load_n::<i32, i16, Stk, Reg>,
                    instr_r: exec::load_n::<i32, i16, Reg, Reg>,
                    instr_i: Some(exec::load_n::<i32, i16, Imm, Reg>),
                },
            },
        ),
        0x2F => visitor.visit_load(
            decoder.decode()?,
            LoadInfo {
                max_align: 1,
                op: UnOpInfo {
                    _name: "i32_load16_u",
                    input_type: ValType::I32,
                    output_type: Some(ValType::I32),
                    instr_s: exec::load_n::<u32, u16, Stk, Reg>,
                    instr_r: exec::load_n::<u32, u16, Reg, Reg>,
                    instr_i: Some(exec::load_n::<u32, u16, Imm, Reg>),
                },
            },
        ),
        0x30 => visitor.visit_load(
            decoder.decode()?,
            LoadInfo {
                max_align: 0,
                op: UnOpInfo {
                    _name: "i64_load8_s",
                    input_type: ValType::I32,
                    output_type: Some(ValType::I64),
                    instr_s: exec::load_n::<i64, i8, Stk, Reg>,
                    instr_r: exec::load_n::<i64, i8, Reg, Reg>,
                    instr_i: Some(exec::load_n::<i64, i8, Imm, Reg>),
                },
            },
        ),
        0x31 => visitor.visit_load(
            decoder.decode()?,
            LoadInfo {
                max_align: 0,
                op: UnOpInfo {
                    _name: "i64_load8_u",
                    input_type: ValType::I32,
                    output_type: Some(ValType::I64),
                    instr_s: exec::load_n::<u64, u8, Stk, Reg>,
                    instr_r: exec::load_n::<u64, u8, Reg, Reg>,
                    instr_i: Some(exec::load_n::<u64, u8, Imm, Reg>),
                },
            },
        ),
        0x32 => visitor.visit_load(
            decoder.decode()?,
            LoadInfo {
                max_align: 1,
                op: UnOpInfo {
                    _name: "i64_load16_s",
                    input_type: ValType::I32,
                    output_type: Some(ValType::I64),
                    instr_s: exec::load_n::<i64, i16, Stk, Reg>,
                    instr_r: exec::load_n::<i64, i16, Reg, Reg>,
                    instr_i: Some(exec::load_n::<i64, i16, Imm, Reg>),
                },
            },
        ),
        0x33 => visitor.visit_load(
            decoder.decode()?,
            LoadInfo {
                max_align: 1,
                op: UnOpInfo {
                    _name: "i64_load16_u",
                    input_type: ValType::I32,
                    output_type: Some(ValType::I64),
                    instr_s: exec::load_n::<u64, u16, Stk, Reg>,
                    instr_r: exec::load_n::<u64, u16, Reg, Reg>,
                    instr_i: Some(exec::load_n::<u64, u16, Imm, Reg>),
                },
            },
        ),
        0x34 => visitor.visit_load(
            decoder.decode()?,
            LoadInfo {
                max_align: 2,
                op: UnOpInfo {
                    _name: "i64_load32_s",
                    input_type: ValType::I32,
                    output_type: Some(ValType::I64),
                    instr_s: exec::load_n::<i64, i32, Stk, Reg>,
                    instr_r: exec::load_n::<i64, i32, Reg, Reg>,
                    instr_i: Some(exec::load_n::<i64, i32, Imm, Reg>),
                },
            },
        ),
        0x35 => visitor.visit_load(
            decoder.decode()?,
            LoadInfo {
                max_align: 2,
                op: UnOpInfo {
                    _name: "i64_load32_u",
                    input_type: ValType::I32,
                    output_type: Some(ValType::I64),
                    instr_s: exec::load_n::<u64, u32, Stk, Reg>,
                    instr_r: exec::load_n::<u64, u32, Reg, Reg>,
                    instr_i: Some(exec::load_n::<u64, u32, Imm, Reg>),
                },
            },
        ),
        0x36 => visitor.visit_store(
            decoder.decode()?,
            StoreInfo {
                max_align: 2,
                op: BinOpInfo {
                    _name: "i32_store",
                    input_type_0: ValType::I32,
                    input_type_1: ValType::I32,
                    output_type: None,
                    instr_ss: exec::store::<i32, Stk, Stk>,
                    instr_rs: exec::store::<i32, Reg, Stk>,
                    instr_is: exec::store::<i32, Imm, Stk>,
                    instr_ir: exec::store::<i32, Imm, Reg>,
                    instr_ii: Some(exec::store::<i32, Imm, Imm>),
                    instr_sr: exec::store::<i32, Stk, Reg>,
                    instr_si: exec::store::<i32, Stk, Imm>,
                    instr_ri: exec::store::<i32, Reg, Imm>,
                    instr_rr: None,
                },
            },
        ),
        0x37 => visitor.visit_store(
            decoder.decode()?,
            StoreInfo {
                max_align: 3,
                op: BinOpInfo {
                    _name: "i64_store",
                    input_type_0: ValType::I32,
                    input_type_1: ValType::I64,
                    output_type: None,
                    instr_ss: exec::store::<i64, Stk, Stk>,
                    instr_rs: exec::store::<i64, Reg, Stk>,
                    instr_is: exec::store::<i64, Imm, Stk>,
                    instr_ir: exec::store::<i64, Imm, Reg>,
                    instr_ii: Some(exec::store::<i64, Imm, Imm>),
                    instr_sr: exec::store::<i64, Stk, Reg>,
                    instr_si: exec::store::<i64, Stk, Imm>,
                    instr_ri: exec::store::<i64, Reg, Imm>,
                    instr_rr: None,
                },
            },
        ),
        0x38 => visitor.visit_store(
            decoder.decode()?,
            StoreInfo {
                max_align: 2,
                op: BinOpInfo {
                    _name: "f32_store",
                    input_type_0: ValType::I32,
                    input_type_1: ValType::F32,
                    output_type: None,
                    instr_ss: exec::store::<f32, Stk, Stk>,
                    instr_rs: exec::store::<f32, Reg, Stk>,
                    instr_is: exec::store::<f32, Imm, Stk>,
                    instr_ir: exec::store::<f32, Imm, Reg>,
                    instr_ii: Some(exec::store::<f32, Imm, Imm>),
                    instr_sr: exec::store::<f32, Stk, Reg>,
                    instr_si: exec::store::<f32, Stk, Imm>,
                    instr_ri: exec::store::<f32, Reg, Imm>,
                    instr_rr: Some(exec::store::<f32, Reg, Reg>),
                },
            },
        ),
        0x39 => visitor.visit_store(
            decoder.decode()?,
            StoreInfo {
                max_align: 3,
                op: BinOpInfo {
                    _name: "f64_store",
                    input_type_0: ValType::I32,
                    input_type_1: ValType::F64,
                    output_type: None,
                    instr_ss: exec::store::<f64, Stk, Stk>,
                    instr_rs: exec::store::<f64, Reg, Stk>,
                    instr_is: exec::store::<f64, Imm, Stk>,
                    instr_ir: exec::store::<f64, Imm, Reg>,
                    instr_ii: Some(exec::store::<f64, Imm, Imm>),
                    instr_sr: exec::store::<f64, Stk, Reg>,
                    instr_si: exec::store::<f64, Stk, Imm>,
                    instr_ri: exec::store::<f64, Reg, Imm>,
                    instr_rr: Some(exec::store::<f64, Reg, Reg>),
                },
            },
        ),
        0x3A => visitor.visit_store(
            decoder.decode()?,
            StoreInfo {
                max_align: 0,
                op: BinOpInfo {
                    _name: "i32_store8",
                    input_type_0: ValType::I32,
                    input_type_1: ValType::I32,
                    output_type: None,
                    instr_ss: exec::store_n::<i32, i8, Stk, Stk>,
                    instr_rs: exec::store_n::<i32, i8, Reg, Stk>,
                    instr_is: exec::store_n::<i32, i8, Imm, Stk>,
                    instr_ir: exec::store_n::<i32, i8, Imm, Reg>,
                    instr_ii: Some(exec::store_n::<i32, i8, Imm, Imm>),
                    instr_sr: exec::store_n::<i32, i8, Stk, Reg>,
                    instr_si: exec::store_n::<i32, i8, Stk, Imm>,
                    instr_ri: exec::store_n::<i32, i8, Reg, Imm>,
                    instr_rr: None,
                },
            },
        ),
        0x3B => visitor.visit_store(
            decoder.decode()?,
            StoreInfo {
                max_align: 1,
                op: BinOpInfo {
                    _name: "i32_store16",
                    input_type_0: ValType::I32,
                    input_type_1: ValType::I32,
                    output_type: None,
                    instr_ss: exec::store_n::<i32, i16, Stk, Stk>,
                    instr_rs: exec::store_n::<i32, i16, Reg, Stk>,
                    instr_is: exec::store_n::<i32, i16, Imm, Stk>,
                    instr_ir: exec::store_n::<i32, i16, Imm, Reg>,
                    instr_ii: Some(exec::store_n::<i32, i16, Imm, Imm>),
                    instr_sr: exec::store_n::<i32, i16, Stk, Reg>,
                    instr_si: exec::store_n::<i32, i16, Stk, Imm>,
                    instr_ri: exec::store_n::<i32, i16, Reg, Imm>,
                    instr_rr: None,
                },
            },
        ),
        0x3C => visitor.visit_store(
            decoder.decode()?,
            StoreInfo {
                max_align: 0,
                op: BinOpInfo {
                    _name: "i64_store8",
                    input_type_0: ValType::I32,
                    input_type_1: ValType::I64,
                    output_type: None,
                    instr_ss: exec::store_n::<i64, i8, Stk, Stk>,
                    instr_rs: exec::store_n::<i64, i8, Reg, Stk>,
                    instr_is: exec::store_n::<i64, i8, Imm, Stk>,
                    instr_ir: exec::store_n::<i64, i8, Imm, Reg>,
                    instr_ii: Some(exec::store_n::<i64, i8, Imm, Imm>),
                    instr_sr: exec::store_n::<i64, i8, Stk, Reg>,
                    instr_si: exec::store_n::<i64, i8, Stk, Imm>,
                    instr_ri: exec::store_n::<i64, i8, Reg, Imm>,
                    instr_rr: None,
                },
            },
        ),
        0x3D => visitor.visit_store(
            decoder.decode()?,
            StoreInfo {
                max_align: 1,
                op: BinOpInfo {
                    _name: "i64_store16",
                    input_type_0: ValType::I32,
                    input_type_1: ValType::I64,
                    output_type: None,
                    instr_ss: exec::store_n::<i64, i16, Stk, Stk>,
                    instr_rs: exec::store_n::<i64, i16, Reg, Stk>,
                    instr_is: exec::store_n::<i64, i16, Imm, Stk>,
                    instr_ir: exec::store_n::<i64, i16, Imm, Reg>,
                    instr_ii: Some(exec::store_n::<i64, i16, Imm, Imm>),
                    instr_sr: exec::store_n::<i64, i16, Stk, Reg>,
                    instr_si: exec::store_n::<i64, i16, Stk, Imm>,
                    instr_ri: exec::store_n::<i64, i16, Reg, Imm>,
                    instr_rr: None,
                },
            },
        ),
        0x3E => visitor.visit_store(
            decoder.decode()?,
            StoreInfo {
                max_align: 2,
                op: BinOpInfo {
                    _name: "i64_store32",
                    input_type_0: ValType::I32,
                    input_type_1: ValType::I64,
                    output_type: None,
                    instr_ss: exec::store_n::<i64, i32, Stk, Stk>,
                    instr_rs: exec::store_n::<i64, i32, Reg, Stk>,
                    instr_is: exec::store_n::<i64, i32, Imm, Stk>,
                    instr_ir: exec::store_n::<i64, i32, Imm, Reg>,
                    instr_ii: Some(exec::store_n::<i64, i32, Imm, Imm>),
                    instr_sr: exec::store_n::<i64, i32, Stk, Reg>,
                    instr_si: exec::store_n::<i64, i32, Stk, Imm>,
                    instr_ri: exec::store_n::<i64, i32, Reg, Imm>,
                    instr_rr: None,
                },
            },
        ),
        0x3F => {
            if decoder.read_byte()? != 0x00 {
                return Err(DecodeError::new("expected zero byte"))?;
            }
            visitor.visit_memory_size()
        }
        0x40 => {
            if decoder.read_byte()? != 0x00 {
                return Err(DecodeError::new("expected zero byte"))?;
            }
            visitor.visit_memory_grow()
        }
        0x41 => visitor.visit_i32_const(decoder.decode()?),
        0x42 => visitor.visit_i64_const(decoder.decode()?),
        0x43 => visitor.visit_f32_const(decoder.decode()?),
        0x44 => visitor.visit_f64_const(decoder.decode()?),
        0x45 => visitor.visit_un_op(UnOpInfo {
            _name: "i32_eqz",
            input_type: ValType::I32,
            output_type: Some(ValType::I32),
            instr_s: exec::un_op::<i32, Eqz, Stk, Reg>,
            instr_r: exec::un_op::<i32, Eqz, Reg, Reg>,
            instr_i: None,
        }),
        0x46 => visitor.visit_bin_op(BinOpInfo {
            _name: "i32_eq",
            input_type_0: ValType::I32,
            input_type_1: ValType::I32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<i32, Eq, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i32, Eq, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i32, Eq, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i32, Eq, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i32, Eq, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i32, Eq, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i32, Eq, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x47 => visitor.visit_bin_op(BinOpInfo {
            _name: "i32_ne",
            input_type_0: ValType::I32,
            input_type_1: ValType::I32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<i32, Ne, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i32, Ne, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i32, Ne, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i32, Ne, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i32, Ne, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i32, Ne, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i32, Ne, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x48 => visitor.visit_bin_op(BinOpInfo {
            _name: "i32_lt_s",
            input_type_0: ValType::I32,
            input_type_1: ValType::I32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<i32, Lt, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i32, Lt, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i32, Lt, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i32, Lt, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i32, Lt, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i32, Lt, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i32, Lt, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x49 => visitor.visit_bin_op(BinOpInfo {
            _name: "i32_lt_u",
            input_type_0: ValType::I32,
            input_type_1: ValType::I32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<u32, Lt, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<u32, Lt, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<u32, Lt, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<u32, Lt, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<u32, Lt, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<u32, Lt, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<u32, Lt, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x4A => visitor.visit_bin_op(BinOpInfo {
            _name: "i32_gt_s",
            input_type_0: ValType::I32,
            input_type_1: ValType::I32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<i32, Gt, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i32, Gt, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i32, Gt, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i32, Gt, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i32, Gt, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i32, Gt, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i32, Gt, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x4B => visitor.visit_bin_op(BinOpInfo {
            _name: "i32_gt_u",
            input_type_0: ValType::I32,
            input_type_1: ValType::I32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<u32, Gt, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<u32, Gt, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<u32, Gt, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<u32, Gt, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<u32, Gt, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<u32, Gt, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<u32, Gt, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x4C => visitor.visit_bin_op(BinOpInfo {
            _name: "i32_le_s",
            input_type_0: ValType::I32,
            input_type_1: ValType::I32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<i32, Le, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i32, Le, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i32, Le, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i32, Le, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i32, Le, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i32, Le, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i32, Le, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x4D => visitor.visit_bin_op(BinOpInfo {
            _name: "i32_le_u",
            input_type_0: ValType::I32,
            input_type_1: ValType::I32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<u32, Le, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<u32, Le, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<u32, Le, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<u32, Le, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<u32, Le, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<u32, Le, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<u32, Le, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x4E => visitor.visit_bin_op(BinOpInfo {
            _name: "i32_ge_s",
            input_type_0: ValType::I32,
            input_type_1: ValType::I32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<i32, Ge, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i32, Ge, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i32, Ge, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i32, Ge, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i32, Ge, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i32, Ge, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i32, Ge, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x4F => visitor.visit_bin_op(BinOpInfo {
            _name: "i32_ge_u",
            input_type_0: ValType::I32,
            input_type_1: ValType::I32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<u32, Ge, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<u32, Ge, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<u32, Ge, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<u32, Ge, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<u32, Ge, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<u32, Ge, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<u32, Ge, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x50 => visitor.visit_un_op(UnOpInfo {
            _name: "i64_eqz",
            input_type: ValType::I64,
            output_type: Some(ValType::I32),
            instr_s: exec::un_op::<i64, Eqz, Stk, Reg>,
            instr_r: exec::un_op::<i64, Eqz, Reg, Reg>,
            instr_i: None,
        }),
        0x51 => visitor.visit_bin_op(BinOpInfo {
            _name: "i64_eq",
            input_type_0: ValType::I64,
            input_type_1: ValType::I64,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<i64, Eq, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i64, Eq, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i64, Eq, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i64, Eq, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i64, Eq, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i64, Eq, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i64, Eq, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x52 => visitor.visit_bin_op(BinOpInfo {
            _name: "i64_ne",
            input_type_0: ValType::I64,
            input_type_1: ValType::I64,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<i64, Ne, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i64, Ne, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i64, Ne, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i64, Ne, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i64, Ne, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i64, Ne, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i64, Ne, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x53 => visitor.visit_bin_op(BinOpInfo {
            _name: "i64_lt_s",
            input_type_0: ValType::I64,
            input_type_1: ValType::I64,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<i64, Lt, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i64, Lt, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i64, Lt, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i64, Lt, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i64, Lt, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i64, Lt, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i64, Lt, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x54 => visitor.visit_bin_op(BinOpInfo {
            _name: "i64_lt_u",
            input_type_0: ValType::I64,
            input_type_1: ValType::I64,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<u64, Lt, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<u64, Lt, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<u64, Lt, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<u64, Lt, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<u64, Lt, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<u64, Lt, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<u64, Lt, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x55 => visitor.visit_bin_op(BinOpInfo {
            _name: "i64_gt_s",
            input_type_0: ValType::I64,
            input_type_1: ValType::I64,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<i64, Gt, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i64, Gt, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i64, Gt, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i64, Gt, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i64, Gt, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i64, Gt, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i64, Gt, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x56 => visitor.visit_bin_op(BinOpInfo {
            _name: "i64_gt_u",
            input_type_0: ValType::I64,
            input_type_1: ValType::I64,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<u64, Gt, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<u64, Gt, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<u64, Gt, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<u64, Gt, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<u64, Gt, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<u64, Gt, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<u64, Gt, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x57 => visitor.visit_bin_op(BinOpInfo {
            _name: "i64_le_s",
            input_type_0: ValType::I64,
            input_type_1: ValType::I64,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<i64, Le, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i64, Le, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i64, Le, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i64, Le, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i64, Le, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i64, Le, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i64, Le, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x58 => visitor.visit_bin_op(BinOpInfo {
            _name: "i64_le_u",
            input_type_0: ValType::I64,
            input_type_1: ValType::I64,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<u64, Le, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<u64, Le, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<u64, Le, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<u64, Le, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<u64, Le, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<u64, Le, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<u64, Le, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x59 => visitor.visit_bin_op(BinOpInfo {
            _name: "i64_ge_s",
            input_type_0: ValType::I64,
            input_type_1: ValType::I64,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<i64, Ge, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i64, Ge, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i64, Ge, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i64, Ge, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i64, Ge, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i64, Ge, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i64, Ge, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x5A => visitor.visit_bin_op(BinOpInfo {
            _name: "i64_ge_u",
            input_type_0: ValType::I64,
            input_type_1: ValType::I64,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<u64, Ge, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<u64, Ge, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<u64, Ge, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<u64, Ge, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<u64, Ge, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<u64, Ge, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<u64, Ge, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x5B => visitor.visit_bin_op(BinOpInfo {
            _name: "f32_eq",
            input_type_0: ValType::F32,
            input_type_1: ValType::F32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<f32, Eq, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<f32, Eq, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<f32, Eq, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<f32, Eq, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<f32, Eq, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<f32, Eq, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<f32, Eq, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x5C => visitor.visit_bin_op(BinOpInfo {
            _name: "f32_ne",
            input_type_0: ValType::F32,
            input_type_1: ValType::F32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<f32, Ne, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<f32, Ne, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<f32, Ne, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<f32, Ne, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<f32, Ne, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<f32, Ne, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<f32, Ne, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x5D => visitor.visit_bin_op(BinOpInfo {
            _name: "f32_lt",
            input_type_0: ValType::F32,
            input_type_1: ValType::F32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<f32, Lt, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<f32, Lt, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<f32, Lt, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<f32, Lt, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<f32, Lt, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<f32, Lt, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<f32, Lt, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x5E => visitor.visit_bin_op(BinOpInfo {
            _name: "f32_gt",
            input_type_0: ValType::F32,
            input_type_1: ValType::F32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<f32, Gt, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<f32, Gt, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<f32, Gt, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<f32, Gt, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<f32, Gt, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<f32, Gt, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<f32, Gt, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x5F => visitor.visit_bin_op(BinOpInfo {
            _name: "f32_le",
            input_type_0: ValType::F32,
            input_type_1: ValType::F32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<f32, Le, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<f32, Le, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<f32, Le, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<f32, Le, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<f32, Le, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<f32, Le, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<f32, Le, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x60 => visitor.visit_bin_op(BinOpInfo {
            _name: "f32_ge",
            input_type_0: ValType::F32,
            input_type_1: ValType::F32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<f32, Ge, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<f32, Ge, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<f32, Ge, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<f32, Ge, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<f32, Ge, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<f32, Ge, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<f32, Ge, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x61 => visitor.visit_bin_op(BinOpInfo {
            _name: "f64_eq",
            input_type_0: ValType::F64,
            input_type_1: ValType::F64,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<f64, Eq, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<f64, Eq, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<f64, Eq, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<f64, Eq, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<f64, Eq, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<f64, Eq, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<f64, Eq, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x62 => visitor.visit_bin_op(BinOpInfo {
            _name: "f64_ne",
            input_type_0: ValType::F64,
            input_type_1: ValType::F64,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<f64, Ne, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<f64, Ne, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<f64, Ne, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<f64, Ne, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<f64, Ne, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<f64, Ne, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<f64, Ne, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x63 => visitor.visit_bin_op(BinOpInfo {
            _name: "f64_lt",
            input_type_0: ValType::F64,
            input_type_1: ValType::F64,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<f64, Lt, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<f64, Lt, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<f64, Lt, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<f64, Lt, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<f64, Lt, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<f64, Lt, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<f64, Lt, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x64 => visitor.visit_bin_op(BinOpInfo {
            _name: "f64_gt",
            input_type_0: ValType::F64,
            input_type_1: ValType::F64,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<f64, Gt, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<f64, Gt, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<f64, Gt, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<f64, Gt, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<f64, Gt, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<f64, Gt, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<f64, Gt, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x65 => visitor.visit_bin_op(BinOpInfo {
            _name: "f64_le",
            input_type_0: ValType::F64,
            input_type_1: ValType::F64,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<f64, Le, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<f64, Le, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<f64, Le, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<f64, Le, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<f64, Le, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<f64, Le, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<f64, Le, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x66 => visitor.visit_bin_op(BinOpInfo {
            _name: "f64_ge",
            input_type_0: ValType::F64,
            input_type_1: ValType::F64,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<f64, Ge, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<f64, Ge, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<f64, Ge, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<f64, Ge, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<f64, Ge, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<f64, Ge, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<f64, Ge, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x67 => visitor.visit_un_op(UnOpInfo {
            _name: "i32_clz",
            input_type: ValType::I32,
            output_type: Some(ValType::I32),
            instr_s: exec::un_op::<i32, Clz, Stk, Reg>,
            instr_r: exec::un_op::<i32, Clz, Reg, Reg>,
            instr_i: None,
        }),
        0x68 => visitor.visit_un_op(UnOpInfo {
            _name: "i32_ctz",
            input_type: ValType::I32,
            output_type: Some(ValType::I32),
            instr_s: exec::un_op::<i32, Ctz, Stk, Reg>,
            instr_r: exec::un_op::<i32, Ctz, Reg, Reg>,
            instr_i: None,
        }),
        0x69 => visitor.visit_un_op(UnOpInfo {
            _name: "i32_popcnt",
            input_type: ValType::I32,
            output_type: Some(ValType::I32),
            instr_s: exec::un_op::<i32, Popcnt, Stk, Reg>,
            instr_r: exec::un_op::<i32, Popcnt, Reg, Reg>,
            instr_i: None,
        }),
        0x6A => visitor.visit_bin_op(BinOpInfo {
            _name: "i32_add",
            input_type_0: ValType::I32,
            input_type_1: ValType::I32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<i32, Add, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i32, Add, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i32, Add, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i32, Add, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i32, Add, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i32, Add, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i32, Add, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x6B => visitor.visit_bin_op(BinOpInfo {
            _name: "i32_sub",
            input_type_0: ValType::I32,
            input_type_1: ValType::I32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<i32, Sub, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i32, Sub, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i32, Sub, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i32, Sub, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i32, Sub, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i32, Sub, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i32, Sub, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x6C => visitor.visit_bin_op(BinOpInfo {
            _name: "i32_mul",
            input_type_0: ValType::I32,
            input_type_1: ValType::I32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<i32, Mul, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i32, Mul, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i32, Mul, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i32, Mul, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i32, Mul, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i32, Mul, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i32, Mul, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x6D => visitor.visit_bin_op(BinOpInfo {
            _name: "i32_div_s",
            input_type_0: ValType::I32,
            input_type_1: ValType::I32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<i32, Div, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i32, Div, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i32, Div, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i32, Div, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i32, Div, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i32, Div, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i32, Div, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x6E => visitor.visit_bin_op(BinOpInfo {
            _name: "i32_div_u",
            input_type_0: ValType::I32,
            input_type_1: ValType::I32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<u32, Div, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<u32, Div, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<u32, Div, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<u32, Div, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<u32, Div, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<u32, Div, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<u32, Div, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x6F => visitor.visit_bin_op(BinOpInfo {
            _name: "i32_rem_s",
            input_type_0: ValType::I32,
            input_type_1: ValType::I32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<i32, Rem, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i32, Rem, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i32, Rem, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i32, Rem, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i32, Rem, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i32, Rem, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i32, Rem, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x70 => visitor.visit_bin_op(BinOpInfo {
            _name: "i32_rem_u",
            input_type_0: ValType::I32,
            input_type_1: ValType::I32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<u32, Rem, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<u32, Rem, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<u32, Rem, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<u32, Rem, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<u32, Rem, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<u32, Rem, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<u32, Rem, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x71 => visitor.visit_bin_op(BinOpInfo {
            _name: "i32_and",
            input_type_0: ValType::I32,
            input_type_1: ValType::I32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<i32, And, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i32, And, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i32, And, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i32, And, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i32, And, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i32, And, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i32, And, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x72 => visitor.visit_bin_op(BinOpInfo {
            _name: "i32_or",
            input_type_0: ValType::I32,
            input_type_1: ValType::I32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<i32, Or, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i32, Or, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i32, Or, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i32, Or, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i32, Or, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i32, Or, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i32, Or, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x73 => visitor.visit_bin_op(BinOpInfo {
            _name: "i32_xor",
            input_type_0: ValType::I32,
            input_type_1: ValType::I32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<i32, Xor, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i32, Xor, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i32, Xor, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i32, Xor, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i32, Xor, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i32, Xor, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i32, Xor, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x74 => visitor.visit_bin_op(BinOpInfo {
            _name: "i32_shl",
            input_type_0: ValType::I32,
            input_type_1: ValType::I32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<i32, Shl, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i32, Shl, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i32, Shl, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i32, Shl, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i32, Shl, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i32, Shl, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i32, Shl, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x75 => visitor.visit_bin_op(BinOpInfo {
            _name: "i32_shr_s",
            input_type_0: ValType::I32,
            input_type_1: ValType::I32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<i32, Shr, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i32, Shr, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i32, Shr, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i32, Shr, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i32, Shr, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i32, Shr, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i32, Shr, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x76 => visitor.visit_bin_op(BinOpInfo {
            _name: "i32_shr_u",
            input_type_0: ValType::I32,
            input_type_1: ValType::I32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<u32, Shr, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<u32, Shr, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<u32, Shr, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<u32, Shr, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<u32, Shr, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<u32, Shr, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<u32, Shr, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x77 => visitor.visit_bin_op(BinOpInfo {
            _name: "i32_rotl",
            input_type_0: ValType::I32,
            input_type_1: ValType::I32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<i32, Rotl, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i32, Rotl, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i32, Rotl, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i32, Rotl, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i32, Rotl, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i32, Rotl, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i32, Rotl, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x78 => visitor.visit_bin_op(BinOpInfo {
            _name: "i32_rotr",
            input_type_0: ValType::I32,
            input_type_1: ValType::I32,
            output_type: Some(ValType::I32),
            instr_ss: exec::bin_op::<i32, Rotr, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i32, Rotr, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i32, Rotr, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i32, Rotr, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i32, Rotr, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i32, Rotr, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i32, Rotr, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x79 => visitor.visit_un_op(UnOpInfo {
            _name: "i64_clz",
            input_type: ValType::I64,
            output_type: Some(ValType::I64),
            instr_s: exec::un_op::<i64, Clz, Stk, Reg>,
            instr_r: exec::un_op::<i64, Clz, Reg, Reg>,
            instr_i: None,
        }),
        0x7A => visitor.visit_un_op(UnOpInfo {
            _name: "i64_ctz",
            input_type: ValType::I64,
            output_type: Some(ValType::I64),
            instr_s: exec::un_op::<i64, Ctz, Stk, Reg>,
            instr_r: exec::un_op::<i64, Ctz, Reg, Reg>,
            instr_i: None,
        }),
        0x7B => visitor.visit_un_op(UnOpInfo {
            _name: "i64_popcnt",
            input_type: ValType::I64,
            output_type: Some(ValType::I64),
            instr_s: exec::un_op::<i64, Popcnt, Stk, Reg>,
            instr_r: exec::un_op::<i64, Popcnt, Reg, Reg>,
            instr_i: None,
        }),
        0x7C => visitor.visit_bin_op(BinOpInfo {
            _name: "i64_add",
            input_type_0: ValType::I64,
            input_type_1: ValType::I64,
            output_type: Some(ValType::I64),
            instr_ss: exec::bin_op::<i64, Add, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i64, Add, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i64, Add, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i64, Add, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i64, Add, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i64, Add, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i64, Add, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x7D => visitor.visit_bin_op(BinOpInfo {
            _name: "i64_sub",
            input_type_0: ValType::I64,
            input_type_1: ValType::I64,
            output_type: Some(ValType::I64),
            instr_ss: exec::bin_op::<i64, Sub, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i64, Sub, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i64, Sub, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i64, Sub, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i64, Sub, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i64, Sub, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i64, Sub, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x7E => visitor.visit_bin_op(BinOpInfo {
            _name: "i64_mul",
            input_type_0: ValType::I64,
            input_type_1: ValType::I64,
            output_type: Some(ValType::I64),
            instr_ss: exec::bin_op::<i64, Mul, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i64, Mul, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i64, Mul, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i64, Mul, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i64, Mul, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i64, Mul, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i64, Mul, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x7F => visitor.visit_bin_op(BinOpInfo {
            _name: "i64_div_s",
            input_type_0: ValType::I64,
            input_type_1: ValType::I64,
            output_type: Some(ValType::I64),
            instr_ss: exec::bin_op::<i64, Div, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i64, Div, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i64, Div, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i64, Div, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i64, Div, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i64, Div, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i64, Div, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x80 => visitor.visit_bin_op(BinOpInfo {
            _name: "i64_div_u",
            input_type_0: ValType::I64,
            input_type_1: ValType::I64,
            output_type: Some(ValType::I64),
            instr_ss: exec::bin_op::<u64, Div, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<u64, Div, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<u64, Div, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<u64, Div, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<u64, Div, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<u64, Div, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<u64, Div, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x81 => visitor.visit_bin_op(BinOpInfo {
            _name: "i64_rem_s",
            input_type_0: ValType::I64,
            input_type_1: ValType::I64,
            output_type: Some(ValType::I64),
            instr_ss: exec::bin_op::<i64, Rem, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i64, Rem, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i64, Rem, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i64, Rem, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i64, Rem, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i64, Rem, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i64, Rem, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x82 => visitor.visit_bin_op(BinOpInfo {
            _name: "i64_rem_u",
            input_type_0: ValType::I64,
            input_type_1: ValType::I64,
            output_type: Some(ValType::I64),
            instr_ss: exec::bin_op::<u64, Rem, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<u64, Rem, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<u64, Rem, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<u64, Rem, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<u64, Rem, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<u64, Rem, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<u64, Rem, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x83 => visitor.visit_bin_op(BinOpInfo {
            _name: "i64_and",
            input_type_0: ValType::I64,
            input_type_1: ValType::I64,
            output_type: Some(ValType::I64),
            instr_ss: exec::bin_op::<i64, And, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i64, And, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i64, And, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i64, And, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i64, And, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i64, And, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i64, And, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x84 => visitor.visit_bin_op(BinOpInfo {
            _name: "i64_or",
            input_type_0: ValType::I64,
            input_type_1: ValType::I64,
            output_type: Some(ValType::I64),
            instr_ss: exec::bin_op::<i64, Or, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i64, Or, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i64, Or, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i64, Or, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i64, Or, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i64, Or, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i64, Or, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x85 => visitor.visit_bin_op(BinOpInfo {
            _name: "i64_xor",
            input_type_0: ValType::I64,
            input_type_1: ValType::I64,
            output_type: Some(ValType::I64),
            instr_ss: exec::bin_op::<i64, Xor, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i64, Xor, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i64, Xor, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i64, Xor, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i64, Xor, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i64, Xor, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i64, Xor, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x86 => visitor.visit_bin_op(BinOpInfo {
            _name: "i64_shl",
            input_type_0: ValType::I64,
            input_type_1: ValType::I64,
            output_type: Some(ValType::I64),
            instr_ss: exec::bin_op::<i64, Shl, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i64, Shl, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i64, Shl, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i64, Shl, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i64, Shl, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i64, Shl, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i64, Shl, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x87 => visitor.visit_bin_op(BinOpInfo {
            _name: "i64_shr_s",
            input_type_0: ValType::I64,
            input_type_1: ValType::I64,
            output_type: Some(ValType::I64),
            instr_ss: exec::bin_op::<i64, Shr, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i64, Shr, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i64, Shr, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i64, Shr, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i64, Shr, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i64, Shr, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i64, Shr, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x88 => visitor.visit_bin_op(BinOpInfo {
            _name: "i64_shr_u",
            input_type_0: ValType::I64,
            input_type_1: ValType::I64,
            output_type: Some(ValType::I64),
            instr_ss: exec::bin_op::<u64, Shr, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<u64, Shr, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<u64, Shr, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<u64, Shr, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<u64, Shr, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<u64, Shr, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<u64, Shr, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x89 => visitor.visit_bin_op(BinOpInfo {
            _name: "i64_rotl",
            input_type_0: ValType::I64,
            input_type_1: ValType::I64,
            output_type: Some(ValType::I64),
            instr_ss: exec::bin_op::<i64, Rotl, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i64, Rotl, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i64, Rotl, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i64, Rotl, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i64, Rotl, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i64, Rotl, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i64, Rotl, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x8A => visitor.visit_bin_op(BinOpInfo {
            _name: "i64_rotr",
            input_type_0: ValType::I64,
            input_type_1: ValType::I64,
            output_type: Some(ValType::I64),
            instr_ss: exec::bin_op::<i64, Rotr, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<i64, Rotr, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<i64, Rotr, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<i64, Rotr, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<i64, Rotr, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<i64, Rotr, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<i64, Rotr, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x8B => visitor.visit_un_op(UnOpInfo {
            _name: "f32_abs",
            input_type: ValType::F32,
            output_type: Some(ValType::F32),
            instr_s: exec::un_op::<f32, Abs, Stk, Reg>,
            instr_r: exec::un_op::<f32, Abs, Reg, Reg>,
            instr_i: None,
        }),
        0x8C => visitor.visit_un_op(UnOpInfo {
            _name: "f32_neg",
            input_type: ValType::F32,
            output_type: Some(ValType::F32),
            instr_s: exec::un_op::<f32, Neg, Stk, Reg>,
            instr_r: exec::un_op::<f32, Neg, Reg, Reg>,
            instr_i: None,
        }),
        0x8D => visitor.visit_un_op(UnOpInfo {
            _name: "f32_ceil",
            input_type: ValType::F32,
            output_type: Some(ValType::F32),
            instr_s: exec::un_op::<f32, Ceil, Stk, Reg>,
            instr_r: exec::un_op::<f32, Ceil, Reg, Reg>,
            instr_i: None,
        }),
        0x8E => visitor.visit_un_op(UnOpInfo {
            _name: "f32_floor",
            input_type: ValType::F32,
            output_type: Some(ValType::F32),
            instr_s: exec::un_op::<f32, Floor, Stk, Reg>,
            instr_r: exec::un_op::<f32, Floor, Reg, Reg>,
            instr_i: None,
        }),
        0x8F => visitor.visit_un_op(UnOpInfo {
            _name: "f32_trunc",
            input_type: ValType::F32,
            output_type: Some(ValType::F32),
            instr_s: exec::un_op::<f32, Trunc, Stk, Reg>,
            instr_r: exec::un_op::<f32, Trunc, Reg, Reg>,
            instr_i: None,
        }),
        0x90 => visitor.visit_un_op(UnOpInfo {
            _name: "f32_nearest",
            input_type: ValType::F32,
            output_type: Some(ValType::F32),
            instr_s: exec::un_op::<f32, Nearest, Stk, Reg>,
            instr_r: exec::un_op::<f32, Nearest, Reg, Reg>,
            instr_i: None,
        }),
        0x91 => visitor.visit_un_op(UnOpInfo {
            _name: "f32_sqrt",
            input_type: ValType::F32,
            output_type: Some(ValType::F32),
            instr_s: exec::un_op::<f32, Sqrt, Stk, Reg>,
            instr_r: exec::un_op::<f32, Sqrt, Reg, Reg>,
            instr_i: None,
        }),
        0x92 => visitor.visit_bin_op(BinOpInfo {
            _name: "f32_add",
            input_type_0: ValType::F32,
            input_type_1: ValType::F32,
            output_type: Some(ValType::F32),
            instr_ss: exec::bin_op::<f32, Add, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<f32, Add, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<f32, Add, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<f32, Add, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<f32, Add, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<f32, Add, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<f32, Add, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x93 => visitor.visit_bin_op(BinOpInfo {
            _name: "f32_sub",
            input_type_0: ValType::F32,
            input_type_1: ValType::F32,
            output_type: Some(ValType::F32),
            instr_ss: exec::bin_op::<f32, Sub, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<f32, Sub, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<f32, Sub, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<f32, Sub, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<f32, Sub, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<f32, Sub, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<f32, Sub, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x94 => visitor.visit_bin_op(BinOpInfo {
            _name: "f32_mul",
            input_type_0: ValType::F32,
            input_type_1: ValType::F32,
            output_type: Some(ValType::F32),
            instr_ss: exec::bin_op::<f32, Mul, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<f32, Mul, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<f32, Mul, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<f32, Mul, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<f32, Mul, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<f32, Mul, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<f32, Mul, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x95 => visitor.visit_bin_op(BinOpInfo {
            _name: "f32_div",
            input_type_0: ValType::F32,
            input_type_1: ValType::F32,
            output_type: Some(ValType::F32),
            instr_ss: exec::bin_op::<f32, Div, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<f32, Div, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<f32, Div, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<f32, Div, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<f32, Div, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<f32, Div, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<f32, Div, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x96 => visitor.visit_bin_op(BinOpInfo {
            _name: "f32_min",
            input_type_0: ValType::F32,
            input_type_1: ValType::F32,
            output_type: Some(ValType::F32),
            instr_ss: exec::bin_op::<f32, Min, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<f32, Min, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<f32, Min, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<f32, Min, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<f32, Min, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<f32, Min, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<f32, Min, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x97 => visitor.visit_bin_op(BinOpInfo {
            _name: "f32_max",
            input_type_0: ValType::F32,
            input_type_1: ValType::F32,
            output_type: Some(ValType::F32),
            instr_ss: exec::bin_op::<f32, Max, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<f32, Max, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<f32, Max, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<f32, Max, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<f32, Max, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<f32, Max, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<f32, Max, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x98 => visitor.visit_bin_op(BinOpInfo {
            _name: "f32_copysign",
            input_type_0: ValType::F32,
            input_type_1: ValType::F32,
            output_type: Some(ValType::F32),
            instr_ss: exec::bin_op::<f32, Copysign, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<f32, Copysign, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<f32, Copysign, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<f32, Copysign, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<f32, Copysign, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<f32, Copysign, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<f32, Copysign, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0x99 => visitor.visit_un_op(UnOpInfo {
            _name: "f64_abs",
            input_type: ValType::F64,
            output_type: Some(ValType::F64),
            instr_s: exec::un_op::<f64, Abs, Stk, Reg>,
            instr_r: exec::un_op::<f64, Abs, Reg, Reg>,
            instr_i: None,
        }),
        0x9A => visitor.visit_un_op(UnOpInfo {
            _name: "f64_neg",
            input_type: ValType::F64,
            output_type: Some(ValType::F64),
            instr_s: exec::un_op::<f64, Neg, Stk, Reg>,
            instr_r: exec::un_op::<f64, Neg, Reg, Reg>,
            instr_i: None,
        }),
        0x9B => visitor.visit_un_op(UnOpInfo {
            _name: "f64_ceil",
            input_type: ValType::F64,
            output_type: Some(ValType::F64),
            instr_s: exec::un_op::<f64, Ceil, Stk, Reg>,
            instr_r: exec::un_op::<f64, Ceil, Reg, Reg>,
            instr_i: None,
        }),
        0x9C => visitor.visit_un_op(UnOpInfo {
            _name: "f64_floor",
            input_type: ValType::F64,
            output_type: Some(ValType::F64),
            instr_s: exec::un_op::<f64, Floor, Stk, Reg>,
            instr_r: exec::un_op::<f64, Floor, Reg, Reg>,
            instr_i: None,
        }),
        0x9D => visitor.visit_un_op(UnOpInfo {
            _name: "f64_trunc",
            input_type: ValType::F64,
            output_type: Some(ValType::F64),
            instr_s: exec::un_op::<f64, Trunc, Stk, Reg>,
            instr_r: exec::un_op::<f64, Trunc, Reg, Reg>,
            instr_i: None,
        }),
        0x9E => visitor.visit_un_op(UnOpInfo {
            _name: "f64_nearest",
            input_type: ValType::F64,
            output_type: Some(ValType::F64),
            instr_s: exec::un_op::<f64, Nearest, Stk, Reg>,
            instr_r: exec::un_op::<f64, Nearest, Reg, Reg>,
            instr_i: None,
        }),
        0x9F => visitor.visit_un_op(UnOpInfo {
            _name: "f64_sqrt",
            input_type: ValType::F64,
            output_type: Some(ValType::F64),
            instr_s: exec::un_op::<f64, Sqrt, Stk, Reg>,
            instr_r: exec::un_op::<f64, Sqrt, Reg, Reg>,
            instr_i: None,
        }),
        0xA0 => visitor.visit_bin_op(BinOpInfo {
            _name: "f32_add",
            input_type_0: ValType::F64,
            input_type_1: ValType::F64,
            output_type: Some(ValType::F64),
            instr_ss: exec::bin_op::<f64, Add, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<f64, Add, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<f64, Add, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<f64, Add, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<f64, Add, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<f64, Add, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<f64, Add, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0xA1 => visitor.visit_bin_op(BinOpInfo {
            _name: "f64_sub",
            input_type_0: ValType::F64,
            input_type_1: ValType::F64,
            output_type: Some(ValType::F64),
            instr_ss: exec::bin_op::<f64, Sub, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<f64, Sub, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<f64, Sub, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<f64, Sub, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<f64, Sub, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<f64, Sub, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<f64, Sub, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0xA2 => visitor.visit_bin_op(BinOpInfo {
            _name: "f64_mul",
            input_type_0: ValType::F64,
            input_type_1: ValType::F64,
            output_type: Some(ValType::F64),
            instr_ss: exec::bin_op::<f64, Mul, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<f64, Mul, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<f64, Mul, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<f64, Mul, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<f64, Mul, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<f64, Mul, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<f64, Mul, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0xA3 => visitor.visit_bin_op(BinOpInfo {
            _name: "f64_div",
            input_type_0: ValType::F64,
            input_type_1: ValType::F64,
            output_type: Some(ValType::F64),
            instr_ss: exec::bin_op::<f64, Div, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<f64, Div, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<f64, Div, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<f64, Div, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<f64, Div, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<f64, Div, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<f64, Div, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0xA4 => visitor.visit_bin_op(BinOpInfo {
            _name: "f64_min",
            input_type_0: ValType::F64,
            input_type_1: ValType::F64,
            output_type: Some(ValType::F64),
            instr_ss: exec::bin_op::<f64, Min, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<f64, Min, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<f64, Min, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<f64, Min, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<f64, Min, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<f64, Min, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<f64, Min, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0xA5 => visitor.visit_bin_op(BinOpInfo {
            _name: "f64_max",
            input_type_0: ValType::F64,
            input_type_1: ValType::F64,
            output_type: Some(ValType::F64),
            instr_ss: exec::bin_op::<f64, Max, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<f64, Max, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<f64, Max, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<f64, Max, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<f64, Max, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<f64, Max, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<f64, Max, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0xA6 => visitor.visit_bin_op(BinOpInfo {
            _name: "f64_copysign",
            input_type_0: ValType::F64,
            input_type_1: ValType::F64,
            output_type: Some(ValType::F64),
            instr_ss: exec::bin_op::<f64, Copysign, Stk, Stk, Reg>,
            instr_rs: exec::bin_op::<f64, Copysign, Reg, Stk, Reg>,
            instr_is: exec::bin_op::<f64, Copysign, Imm, Stk, Reg>,
            instr_ir: exec::bin_op::<f64, Copysign, Imm, Reg, Reg>,
            instr_ii: None,
            instr_sr: exec::bin_op::<f64, Copysign, Stk, Reg, Reg>,
            instr_si: exec::bin_op::<f64, Copysign, Stk, Imm, Reg>,
            instr_ri: exec::bin_op::<f64, Copysign, Reg, Imm, Reg>,
            instr_rr: None,
        }),
        0xA7 => visitor.visit_un_op(UnOpInfo {
            _name: "i32_wrap_i64",
            input_type: ValType::I64,
            output_type: Some(ValType::I32),
            instr_s: exec::un_op::<i64, WrapTo<i32>, Stk, Reg>,
            instr_r: exec::un_op::<i64, WrapTo<i32>, Reg, Reg>,
            instr_i: None,
        }),
        0xA8 => visitor.visit_un_op(UnOpInfo {
            _name: "i32_trunc_f32_s",
            input_type: ValType::F32,
            output_type: Some(ValType::I32),
            instr_s: exec::un_op::<f32, TruncTo<i32>, Stk, Reg>,
            instr_r: exec::un_op::<f32, TruncTo<i32>, Reg, Reg>,
            instr_i: None,
        }),
        0xA9 => visitor.visit_un_op(UnOpInfo {
            _name: "i32_trunc_f32_u",
            input_type: ValType::F32,
            output_type: Some(ValType::I32),
            instr_s: exec::un_op::<f32, TruncTo<u32>, Stk, Reg>,
            instr_r: exec::un_op::<f32, TruncTo<u32>, Reg, Reg>,
            instr_i: None,
        }),
        0xAA => visitor.visit_un_op(UnOpInfo {
            _name: "i32_trunc_f64_s",
            input_type: ValType::F64,
            output_type: Some(ValType::I32),
            instr_s: exec::un_op::<f64, TruncTo<i32>, Stk, Reg>,
            instr_r: exec::un_op::<f64, TruncTo<i32>, Reg, Reg>,
            instr_i: None,
        }),
        0xAB => visitor.visit_un_op(UnOpInfo {
            _name: "i32_trunc_f64_u",
            input_type: ValType::F64,
            output_type: Some(ValType::I32),
            instr_s: exec::un_op::<f64, TruncTo<u32>, Stk, Reg>,
            instr_r: exec::un_op::<f64, TruncTo<u32>, Reg, Reg>,
            instr_i: None,
        }),
        0xAC => visitor.visit_un_op(UnOpInfo {
            _name: "i64_extend_i32_s",
            input_type: ValType::I32,
            output_type: Some(ValType::I64),
            instr_s: exec::un_op::<i32, ExtendTo<i64>, Stk, Reg>,
            instr_r: exec::un_op::<i32, ExtendTo<i64>, Reg, Reg>,
            instr_i: None,
        }),
        0xAD => visitor.visit_un_op(UnOpInfo {
            _name: "i64_extend_i32_u",
            input_type: ValType::I32,
            output_type: Some(ValType::I64),
            instr_s: exec::un_op::<u32, ExtendTo<u64>, Stk, Reg>,
            instr_r: exec::un_op::<u32, ExtendTo<u64>, Reg, Reg>,
            instr_i: None,
        }),
        0xAE => visitor.visit_un_op(UnOpInfo {
            _name: "i64_trunc_f32_s",
            input_type: ValType::F32,
            output_type: Some(ValType::I64),
            instr_s: exec::un_op::<f32, TruncTo<i64>, Stk, Reg>,
            instr_r: exec::un_op::<f32, TruncTo<i64>, Reg, Reg>,
            instr_i: None,
        }),
        0xAF => visitor.visit_un_op(UnOpInfo {
            _name: "i64_trunc_f32_u",
            input_type: ValType::F32,
            output_type: Some(ValType::I64),
            instr_s: exec::un_op::<f32, TruncTo<u64>, Stk, Reg>,
            instr_r: exec::un_op::<f32, TruncTo<u64>, Reg, Reg>,
            instr_i: None,
        }),
        0xB0 => visitor.visit_un_op(UnOpInfo {
            _name: "i64_trunc_f64_s",
            input_type: ValType::F64,
            output_type: Some(ValType::I64),
            instr_s: exec::un_op::<f64, TruncTo<i64>, Stk, Reg>,
            instr_r: exec::un_op::<f64, TruncTo<i64>, Reg, Reg>,
            instr_i: None,
        }),
        0xB1 => visitor.visit_un_op(UnOpInfo {
            _name: "i64_trunc_f64_u",
            input_type: ValType::F64,
            output_type: Some(ValType::I64),
            instr_s: exec::un_op::<f64, TruncTo<u64>, Stk, Reg>,
            instr_r: exec::un_op::<f64, TruncTo<u64>, Reg, Reg>,
            instr_i: None,
        }),
        0xB2 => visitor.visit_un_op(UnOpInfo {
            _name: "f32_convert_i32_s",
            input_type: ValType::I32,
            output_type: Some(ValType::F32),
            instr_s: exec::un_op::<i32, ConvertTo<f32>, Stk, Reg>,
            instr_r: exec::un_op::<i32, ConvertTo<f32>, Reg, Reg>,
            instr_i: None,
        }),
        0xB3 => visitor.visit_un_op(UnOpInfo {
            _name: "f32_convert_i32_u",
            input_type: ValType::I32,
            output_type: Some(ValType::F32),
            instr_s: exec::un_op::<u32, ConvertTo<f32>, Stk, Reg>,
            instr_r: exec::un_op::<u32, ConvertTo<f32>, Reg, Reg>,
            instr_i: None,
        }),
        0xB4 => visitor.visit_un_op(UnOpInfo {
            _name: "f32_convert_i64_s",
            input_type: ValType::I64,
            output_type: Some(ValType::F32),
            instr_s: exec::un_op::<i64, ConvertTo<f32>, Stk, Reg>,
            instr_r: exec::un_op::<i64, ConvertTo<f32>, Reg, Reg>,
            instr_i: None,
        }),
        0xB5 => visitor.visit_un_op(UnOpInfo {
            _name: "f32_convert_i64_u",
            input_type: ValType::I64,
            output_type: Some(ValType::F32),
            instr_s: exec::un_op::<u64, ConvertTo<f32>, Stk, Reg>,
            instr_r: exec::un_op::<u64, ConvertTo<f32>, Reg, Reg>,
            instr_i: None,
        }),
        0xB6 => visitor.visit_un_op(UnOpInfo {
            _name: "f32_demote_f64",
            input_type: ValType::F64,
            output_type: Some(ValType::F32),
            instr_s: exec::un_op::<f64, DemoteTo<f32>, Stk, Reg>,
            instr_r: exec::un_op::<f64, DemoteTo<f32>, Reg, Reg>,
            instr_i: None,
        }),
        0xB7 => visitor.visit_un_op(UnOpInfo {
            _name: "f64_convert_i32_s",
            input_type: ValType::I32,
            output_type: Some(ValType::F64),
            instr_s: exec::un_op::<i32, ConvertTo<f64>, Stk, Reg>,
            instr_r: exec::un_op::<i32, ConvertTo<f64>, Reg, Reg>,
            instr_i: None,
        }),
        0xB8 => visitor.visit_un_op(UnOpInfo {
            _name: "f64_convert_i32_u",
            input_type: ValType::I32,
            output_type: Some(ValType::F64),
            instr_s: exec::un_op::<u32, ConvertTo<f64>, Stk, Reg>,
            instr_r: exec::un_op::<u32, ConvertTo<f64>, Reg, Reg>,
            instr_i: None,
        }),
        0xB9 => visitor.visit_un_op(UnOpInfo {
            _name: "f64_convert_i64_s",
            input_type: ValType::I64,
            output_type: Some(ValType::F64),
            instr_s: exec::un_op::<i64, ConvertTo<f64>, Stk, Reg>,
            instr_r: exec::un_op::<i64, ConvertTo<f64>, Reg, Reg>,
            instr_i: None,
        }),
        0xBA => visitor.visit_un_op(UnOpInfo {
            _name: "f64_convert_i64_u",
            input_type: ValType::I64,
            output_type: Some(ValType::F64),
            instr_s: exec::un_op::<u64, ConvertTo<f64>, Stk, Reg>,
            instr_r: exec::un_op::<u64, ConvertTo<f64>, Reg, Reg>,
            instr_i: None,
        }),
        0xBB => visitor.visit_un_op(UnOpInfo {
            _name: "f64_promote_f32",
            input_type: ValType::F32,
            output_type: Some(ValType::F64),
            instr_s: exec::un_op::<f32, PromoteTo<f64>, Stk, Reg>,
            instr_r: exec::un_op::<f32, PromoteTo<f64>, Reg, Reg>,
            instr_i: None,
        }),
        0xBC => visitor.visit_un_op(UnOpInfo {
            _name: "i32_reinterpret_f32",
            input_type: ValType::F32,
            output_type: Some(ValType::I32),
            instr_s: exec::un_op::<f32, ReinterpretTo<i32>, Stk, Reg>,
            instr_r: exec::un_op::<f32, ReinterpretTo<i32>, Reg, Reg>,
            instr_i: None,
        }),
        0xBD => visitor.visit_un_op(UnOpInfo {
            _name: "i64_reinterpret_f64",
            input_type: ValType::F64,
            output_type: Some(ValType::I64),
            instr_s: exec::un_op::<f64, ReinterpretTo<i64>, Stk, Reg>,
            instr_r: exec::un_op::<f64, ReinterpretTo<i64>, Reg, Reg>,
            instr_i: None,
        }),
        0xBE => visitor.visit_un_op(UnOpInfo {
            _name: "f32_reinterpret_i32",
            input_type: ValType::I32,
            output_type: Some(ValType::F32),
            instr_s: exec::un_op::<i32, ReinterpretTo<f32>, Stk, Reg>,
            instr_r: exec::un_op::<i32, ReinterpretTo<f32>, Reg, Reg>,
            instr_i: None,
        }),
        0xBF => visitor.visit_un_op(UnOpInfo {
            _name: "f64_reinterpret_i64",
            input_type: ValType::I64,
            output_type: Some(ValType::F64),
            instr_s: exec::un_op::<i64, ReinterpretTo<f64>, Stk, Reg>,
            instr_r: exec::un_op::<i64, ReinterpretTo<f64>, Reg, Reg>,
            instr_i: None,
        }),
        0xC0 => visitor.visit_un_op(UnOpInfo {
            _name: "i32_extend8_s",
            input_type: ValType::I32,
            output_type: Some(ValType::I32),
            instr_s: exec::un_op::<i32, ExtendFrom<i8>, Stk, Reg>,
            instr_r: exec::un_op::<i32, ExtendFrom<i8>, Reg, Reg>,
            instr_i: None,
        }),
        0xC1 => visitor.visit_un_op(UnOpInfo {
            _name: "i32_extend16_s",
            input_type: ValType::I32,
            output_type: Some(ValType::I32),
            instr_s: exec::un_op::<i32, ExtendFrom<i16>, Stk, Reg>,
            instr_r: exec::un_op::<i32, ExtendFrom<i16>, Reg, Reg>,
            instr_i: None,
        }),
        0xC2 => visitor.visit_un_op(UnOpInfo {
            _name: "i64_extend8_s",
            input_type: ValType::I64,
            output_type: Some(ValType::I64),
            instr_s: exec::un_op::<i64, ExtendFrom<i8>, Stk, Reg>,
            instr_r: exec::un_op::<i64, ExtendFrom<i8>, Reg, Reg>,
            instr_i: None,
        }),
        0xC3 => visitor.visit_un_op(UnOpInfo {
            _name: "i64_extend16_s",
            input_type: ValType::I64,
            output_type: Some(ValType::I64),
            instr_s: exec::un_op::<i64, ExtendFrom<i16>, Stk, Reg>,
            instr_r: exec::un_op::<i64, ExtendFrom<i16>, Reg, Reg>,
            instr_i: None,
        }),
        0xC4 => visitor.visit_un_op(UnOpInfo {
            _name: "i64_extend32_s",
            input_type: ValType::I64,
            output_type: Some(ValType::I64),
            instr_s: exec::un_op::<i64, ExtendFrom<i32>, Stk, Reg>,
            instr_r: exec::un_op::<i64, ExtendFrom<i32>, Reg, Reg>,
            instr_i: None,
        }),
        0xD0 => visitor.visit_ref_null(decoder.decode()?),
        0xD1 => visitor.visit_ref_is_null(),
        0xD2 => visitor.visit_ref_func(decoder.decode()?),
        0xFC => match decoder.decode::<u32>()? {
            0 => visitor.visit_un_op(UnOpInfo {
                _name: "i32_trunc_sat_f32_s",
                input_type: ValType::F32,
                output_type: Some(ValType::I32),
                instr_s: exec::un_op::<f32, TruncSatTo<i32>, Stk, Reg>,
                instr_r: exec::un_op::<f32, TruncSatTo<i32>, Reg, Reg>,
                instr_i: None,
            }),
            1 => visitor.visit_un_op(UnOpInfo {
                _name: "i32_trunc_sat_f32_u",
                input_type: ValType::F32,
                output_type: Some(ValType::I32),
                instr_s: exec::un_op::<f32, TruncSatTo<u32>, Stk, Reg>,
                instr_r: exec::un_op::<f32, TruncSatTo<u32>, Reg, Reg>,
                instr_i: None,
            }),
            2 => visitor.visit_un_op(UnOpInfo {
                _name: "i32_trunc_sat_f64_s",
                input_type: ValType::F64,
                output_type: Some(ValType::I32),
                instr_s: exec::un_op::<f64, TruncSatTo<i32>, Stk, Reg>,
                instr_r: exec::un_op::<f64, TruncSatTo<i32>, Reg, Reg>,
                instr_i: None,
            }),
            3 => visitor.visit_un_op(UnOpInfo {
                _name: "i32_trunc_sat_f64_u",
                input_type: ValType::F64,
                output_type: Some(ValType::I32),
                instr_s: exec::un_op::<f64, TruncSatTo<u32>, Stk, Reg>,
                instr_r: exec::un_op::<f64, TruncSatTo<u32>, Reg, Reg>,
                instr_i: None,
            }),
            4 => visitor.visit_un_op(UnOpInfo {
                _name: "i64_trunc_sat_f32_s",
                input_type: ValType::F32,
                output_type: Some(ValType::I64),
                instr_s: exec::un_op::<f32, TruncSatTo<i64>, Stk, Reg>,
                instr_r: exec::un_op::<f32, TruncSatTo<i64>, Reg, Reg>,
                instr_i: None,
            }),
            5 => visitor.visit_un_op(UnOpInfo {
                _name: "i64_trunc_sat_f32_u",
                input_type: ValType::F32,
                output_type: Some(ValType::I64),
                instr_s: exec::un_op::<f32, TruncSatTo<u64>, Stk, Reg>,
                instr_r: exec::un_op::<f32, TruncSatTo<u64>, Reg, Reg>,
                instr_i: None,
            }),
            6 => visitor.visit_un_op(UnOpInfo {
                _name: "i64_trunc_sat_f64_s",
                input_type: ValType::F64,
                output_type: Some(ValType::I64),
                instr_s: exec::un_op::<f64, TruncSatTo<i64>, Stk, Reg>,
                instr_r: exec::un_op::<f64, TruncSatTo<i64>, Reg, Reg>,
                instr_i: None,
            }),
            7 => visitor.visit_un_op(UnOpInfo {
                _name: "i64_trunc_sat_f64_u",
                input_type: ValType::F64,
                output_type: Some(ValType::I64),
                instr_s: exec::un_op::<f64, TruncSatTo<u64>, Stk, Reg>,
                instr_r: exec::un_op::<f64, TruncSatTo<u64>, Reg, Reg>,
                instr_i: None,
            }),
            8 => {
                let data_idx = decoder.decode()?;
                if decoder.read_byte()? != 0x00 {
                    return Err(DecodeError::new("expected zero byte"))?;
                }
                visitor.visit_memory_init(data_idx)
            }
            9 => visitor.visit_data_drop(decoder.decode()?),
            10 => {
                if decoder.read_byte()? != 0x00 {
                    return Err(DecodeError::new("expected zero byte"))?;
                }
                if decoder.read_byte()? != 0x00 {
                    return Err(DecodeError::new("expected zero byte"))?;
                }
                visitor.visit_memory_copy()
            }
            11 => {
                if decoder.read_byte()? != 0x00 {
                    return Err(DecodeError::new("expected zero byte"))?;
                }
                visitor.visit_memory_fill()
            }
            12 => {
                let elem_idx = decoder.decode()?;
                let table_idx = decoder.decode()?;
                visitor.visit_table_init(table_idx, elem_idx)
            }
            13 => visitor.visit_elem_drop(decoder.decode()?),
            14 => visitor.visit_table_copy(decoder.decode()?, decoder.decode()?),
            15 => visitor.visit_table_grow(decoder.decode()?),
            16 => visitor.visit_table_size(decoder.decode()?),
            17 => visitor.visit_table_fill(decoder.decode()?),
            _ => Err(DecodeError::new("illegal opcode"))?,
        },
        _ => Err(DecodeError::new("illegal opcode"))?,
    }
}
